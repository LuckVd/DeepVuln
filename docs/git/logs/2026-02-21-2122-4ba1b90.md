# 4ba1b90

## 基本信息

| 字段 | 值 |
|------|-----|
| **时间** | 2026-02-21 21:22:54 |
| **Commit** | 4ba1b90fe0b261ba0b6956905d5fa808e991da4c |
| **Message** | feat(cli): integrate all scan engines into scan command |

## 简介

将所有扫描引擎（Semgrep、CodeQL、Agent）集成到 `deepvuln scan` 命令，支持全量扫描和 LLM 辅助可利用性验证。

## 变更文件

| 文件 | 操作 | 说明 |
|------|------|------|
| `src/cli/main.py` | 修改 | +754 行，添加全量扫描功能 |
| `src/cli/prompts.py` | 修改 | +68 行，交互式引擎选择 |
| `src/layers/l3_analysis/engines/semgrep.py` | 修改 | 修复 --metrics 重复问题 |
| `src/layers/l3_analysis/prompts/__init__.py` | 修改 | 导出新模块 |
| `src/layers/l3_analysis/prompts/exploitability.py` | 新增 | LLM 可利用性评估 Prompt |
| `src/layers/l3_analysis/rounds/round_four.py` | 修改 | +249 行，LLM 辅助判断 |
| `src/layers/l3_analysis/task/context_builder.py` | 修改 | 修复 None function_name |
| `tests/unit/test_l3/test_round_four_llm.py` | 新增 | 15 个 LLM 测试 |
| `tests/unit/test_l3/test_semgrep_engine.py` | 修改 | 更新 auto config 测试 |

## 功能变更

| 功能 | 操作 | 说明 |
|------|------|------|
| `deepvuln scan --full` | 新增 | 全量代码扫描 (semgrep + codeql + agent) |
| `deepvuln scan --engines` | 新增 | 指定扫描引擎 |
| `deepvuln scan --llm-verify` | 新增 | LLM 辅助可利用性验证 |
| `deepvuln scan --model` | 新增 | 指定 LLM 模型 |
| Round 4 LLM 评估 | 新增 | NEEDS_REVIEW 状态调用 LLM 判断 |
| 交互模式扫描类型 | 新增 | 依赖/快速/自定义/全量 四种选择 |

## CLI 命令示例

```bash
# 全量扫描
deepvuln scan -p . --full

# 指定引擎
deepvuln scan -p . --engines semgrep --engines agent

# 启用 LLM 验证
deepvuln scan -p . --full --llm-verify
```

## 测试结果

- 113 passed, 1 warning
- 在 Dubbo 项目验证：55 findings, 55 verified

## 关联目标

- 目标：将所有扫描引擎集成到 CLI scan 命令和交互模式
- 状态：completed
- 完成日期：2026-02-21
